	p68h11
	public	keypad,transla
	extern	outchar
$const.def
****************************************************************************************************************
* KEYPAD
*	Verifica si se pulso alguna tecla y determina las coordenadas de la misma.
* Parametros recibidos: Ninguno
* Parametros entregados: Coordenadas del pulsado por memoria
****************************************************************************************************************
	rseg	CODE
keypad	equ 	*
	psha
	pshb		
	pshx		;programación defensiva
	
	ldab	#$04	;indicador de posicion de columna
	ldaa	#$0	;indicador de posición de fila 
	psha		;con frame pointer lo recuperamos en la subrutina transla
	ldaa	#FIL0
	staa 	PORTC
	ldaa	PORTC
cloop0	asla
	bcc	pul
	decb	
	bge	cloop0
	
	ldab	#$04
	des
	ldaa	#$1	;indicador de posición de fila 
	psha		;con frame pointer lo recuperamos en la subrutina transla
	ldaa	#FIL1
	staa 	PORTC
	ldaa	PORTC
cloop1	asla
	bcc	pul
	decb
	bge	cloop1
	
	ldab	#$04
	des
	ldaa	#$2	;indicador de posición de fila 
	psha		;con frame pointer lo recuperamos en la subrutina transla
	ldaa	#FIL2
	staa 	PORTC
	ldaa	PORTC
cloop2	asla
	bcc	pul
	decb	
	bge	cloop2
	
	ldab	#$04
	des
	ldaa	#$3	;indicador de posición de fila 
	psha		;con frame pointer lo recuperamos en la subrutina transla
	ldaa	#FIL3
	staa 	PORTC
	ldaa	PORTC
cloop3	asla
	bcc	pul
	decb	
	bge	cloop3
	clc		; Aviso por carry que no se apreto
	bra	npul
	
pul	jsr 	transla

npul	pulx		;programación defensiva
	pulb		
	pula
	rts
	
****************************************************************************************************************
****************************************************************************************************************

****************************************************************************************************************
* TRANSLA
* Traduce de coordenadas fila y columna al caracter ascii al que le pertenece a la tecla
*	Parametros recibidos: Coordenadas de fila y columna por memoria. 
*	Parametros enviados: dirección de memoria del nuevo caracter por IY
****************************************************************************************************************
	rseg	CODE
transla	equ	*
	
	pula
	mul
	aby
	
	sec		;Aviso por carry que se cargo un numero
	rts
	
	
****************************************************************************************************************
****************************************************************************************************************

	END
