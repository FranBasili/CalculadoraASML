	p68h11
	public	keypad,transla
	extern	outchar
$const.def
****************************************************************************************************************
* KEYPAD
*	Verifica si se pulso alguna tecla y determina las coordenadas de la misma.
* Parametros recibidos: Ninguno
* Parametros entregados: Coordenadas del pulsado por memoria
****************************************************************************************************************
	rseg	CODE
keypad	equ 	*
	psha
	pshb		;programación defensiva
	
	ldab	#$03
	stab	col
	ldaa	#$0
	staa	fil
	ldaa	#FIL0
	staa 	PORTC
	ldaa	PORTC
cloop0	asla
	bcc	pul
	dec	col	
	ldab	col
	bge	cloop0
	
	ldab	#$03
	stab	col
	ldaa	#$1
	staa	fil
	ldaa	#FIL1
	staa 	PORTC
	ldaa	PORTC
cloop1	asla
	bcc	pul
	dec	col	
	ldab	col
	bge	cloop1
	
	ldab	#$03
	stab	col
	ldaa	#$2
	staa	fil
	ldaa	#FIL2
	staa 	PORTC
	ldaa	PORTC
cloop2	asla
	bcc	pul
	dec	col	
	bge	cloop2
	
	ldab	#$03
	stab	col
	ldaa	#$3
	staa	fil
	ldaa	#FIL3
	staa 	PORTC
	ldaa	PORTC
cloop3	asla
	bcc	pul
	dec	col	
	bge	cloop3
	clc		; Aviso por carry que no se apreto
	bra	npul
	
pul	jsr transla

npul	pulb		;programación defensiva
	pula
	rts
	
****************************************************************************************************************
****************************************************************************************************************

****************************************************************************************************************
* TRANSLA
* Traduce de coordenadas fila y columna al caracter ascii al que le pertenece a la tecla
*	Parametros recibidos: Coordenadas de fila y columna por memoria. 
*	Parametros enviados: dirección de memoria del nuevo caracter por IY
****************************************************************************************************************
	rseg	CODE
transla	equ	*

	psha
	pshb
	pshx
	
	ldaa	fil
	ldab	#4
	mul
	ldaa	col
	aba
	tab
	aby
	
	pulx
	pulb
	pula
	sec		;Aviso por carry que se cargo un numero
	rts
	
	
****************************************************************************************************************
****************************************************************************************************************
	rseg	VARS
col	rmb	1
fil	rmb	1
cyr	rmb 	1

	END
