	p68h11
	public	keypad, transla
$const.def
****************************************************************************************************************
* KEYPAD
*	Verifica si se pulso alguna tecla y determina las coordenadas de la misma.
* Parametros recibidos: Ninguno
* Parametros entregados: Coordenadas del pulsado por memoria
****************************************************************************************************************
	rseg	CODE
keypad	equ 	*
	psha
	pshb		;programación defensiva
	
	ldaa	#$03
	staa	cyr
	
	ldaa	#$0
	staa	row
	ldaa	#FIL0
	staa 	PORTC
cloop0	ldaa	PORTC
	asla
	bcc	pul
	dec	cyr
	bne	cloop0
	
	ldaa	#$1
	staa	row
	ldaa	#FIL0
	staa 	PORTC
cloop1	ldaa	PORTC
	asla
	bcc	pul
	dec	cyr
	bne	cloop1
	
	ldaa	#$2
	staa	row
	ldaa	#FIL0
	staa 	PORTC
cloop2	ldaa	PORTC
	asla
	bcc	pul
	dec	cyr
	bne	cloop2
	
	ldaa	#$3
	staa	row
	ldaa	#FIL0
	staa 	PORTC
cloop3	ldaa	PORTC
	asla
	bcc	pul
	dec	cyr
	bne	cloop3
	bra	npul
	
pul	jsr	transla

npul	pulb		;programación defensiva
	pula
	rts
	
****************************************************************************************************************
****************************************************************************************************************

****************************************************************************************************************
* TRANSLA
* Traduce de coordenadas fila y columna al caracter ascii al que le pertenece a la tecla
*	Parametros recibidos: Coordenadas de fila y columna por memoria. 
*	Parametros enviados: Valor ascii del caracter pulsado.
****************************************************************************************************************
	rseg	CODE
transla	equ	*

	psha
	pshb
	pshx
	
	ldaa	row
	ldab	#4
	mul
	ldaa	col
	aba
	tab
	ldx	#I_STR
	abx
	ldaa	0,x
	staa	caract
	
	pulx
	pulb
	pula
	rts
	
	
	org	$3000
col	rmb	1
row	rmb	1
cyr	rmb 	1

****************************************************************************************************************
****************************************************************************************************************


	END
