	p68h11
	public	calculo
****************************************************************************************************************
* CALCULO
*	Si se pulso F ('=') en el teclado llama a esta subrutina que se encarga de ver cuales son los operandos y 
*	 la operación y realizarla.
* Parametros recibidos: Inicio de número Binary por IX e Inicio de result por IY
* Parametros entregados: resultado de la opeación en result
****************************************************************************************************************
	rseg	CODE
calculo	equ	*
	psha
	pshb
	pshx
	pshy		;programación defensiva
	
	ldaa	#$2A	;comparo con el caracter de multiplicación en ASCII
	cmpa	2,x
	beq	mula
	inca		;comparo con los caracteres de suma en ASCII
	cmpa	2,X	
	beq	suma
	inca
	inca
	cmpa	2,X	
	beq	resta	;si no es ninguno de los anteriores tiene que restar 
****************************************************************************************************************	
diva	equ	*
	ldd	0,x
	ldx	4,x	;4,x es el segundo operando en variables
	idiv
	xgdx
	std	0,y
	bra	fin
	
****************************************************************************************************************	
resta	equ	*
	ldd	0,x
	subd	4,x	;4,x es el segundo operando en variables
	std	0,y
	bra	fin

****************************************************************************************************************
suma	equ	*
	ldd	0,x
	addd	4,x	;4,x es el segundo operando en variables
	std	0,y
	bra	fin
	
****************************************************************************************************************	
mula	equ	*
	ldd	#1111	;un indicador para saber que se invoco a la multiplicación
	std	0,y	;HAY QUE HACER ESTA SUBRUTINA!!!
	
****************************************************************************************************************	

fin	puly		;programación defensiva
	pulx
	pula	
	pulb
	rts
	
	
	
**********************************************************************************************
*DIVISION
*Esta función recibe por indice D el numero signado a dividir y lo divide por el 
*numero que se encuentre en IX. El cociente se entrega en AccD 
*Parametros recibidos: dividendo en AccD, Divisor en IX.
*Parametros entregados: cociente en AccD, resto por IX.
**********************************************************************************************
Division	equ	*
	pshy
	
	xgdy		; transferimos IY a AccD para borrarlo y lo retornamos a IY
	clra
	clrb
	xgdy

	tsta		; Actualizamos el CCR en funcion del dividendo
	bge	nocom1	; Solo si no es negativo, saltamos directo a la división
	iny		; Incremento el contador de numeros negativos
	com	neg	; Si es negativo cargo un "-1" en el flag de negatividad
	coma		; Comienzo realizando un complemento a 2 de forma semimanual, para ello:
	comb		;complemento a 1 Acca y Accb por separado  
	addd	#1	; Sumo uno a AccD
	
	xgdx
nocom1	bge	nocom2	; Solo si no es negativo, saltamos directo a la división
	iny		; Incremento el contador de numeros negativos
	com	neg	; Si es negativo cargo un "-1" en el flag de negatividad
	coma		; Comienzo realizando un complemento a 2 de forma semimanual, para ello:
	comb		;complemento a 1 Acca y Accb por separado  
	addd	#1	; Sumo uno a AccD
	xgdx
	
nocom2	idiv		; Divido el resultado de la suma por la cant de elementos que sume.
	xgdx		; Transfiero el cociente de IX a Accd.
	tst	neg	; Actualizo el CCR en función a la memoria de negatividad
	beq	noC2	; Si el numero era originalmente negativo
	coma		; Una vez realizada la división hago el mismo proceso que hice al 
	comb		;principio pero ahora para obtener resultado de forma signada.
	addb	#1
	bcc	noC2	
	inca
noC2	puly
	rts		; Retorno a la subrutina sin haber modificado ningún registro no deseado
	
**********************************************************************************************
**********************************************************************************************
	rseg	VARS
neg	fcb 	1		;Reservo una memoria donde se indica si el dividendo es o no negativo. 
	
	END